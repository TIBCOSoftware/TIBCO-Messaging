if (CMAKE_BUILD_TYPE STREQUAL "Debug")
    SET(EFTL_CLASSLIB_FLAGS "/debug+")
else()
    SET(EFTL_CLASSLIB_FLAGS "/optimize+")
endif (CMAKE_BUILD_TYPE STREQUAL "Debug")

set(EFTL_KEY_FILE "${CMAKE_CURRENT_SOURCE_DIR}/key.snk")
set(EFTL_CLIENT_LIB "${CMAKE_CURRENT_BINARY_DIR}/TIBCO.EFTL.WINRT.dll")
set(EFTL_CLIENT_LIB "${EFTL_CLIENT_LIB}" PARENT_SCOPE)
set(EFTL_CLIENT_DOC "${CMAKE_CURRENT_BINARY_DIR}/TIBCO.EFTL.WINRT.xml")
set(EFTL_CLIENT_DOC "${EFTL_CLIENT_DOC}" PARENT_SCOPE)
set(EFTL_ASSEMBLY_VERSION "${EFTL_VERSION_MAJOR}.${EFTL_VERSION_MINOR}.${EFTL_VERSION_UPDATE}.${EFTL_VERSION_BUILD}")
SET(EFTL_TRADE "TIB, TIBCO, TIBCO eFTL, and the TIBCO logo are either registered trademarks or trademarks of TIBCO Software Inc. in the United States and/or other countries.")

configure_file(${CMAKE_CURRENT_SOURCE_DIR}/Properties/AssemblyInfo.cs.template ${CMAKE_CURRENT_BINARY_DIR}/AssemblyInfo.cs)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/Version.cs.template ${CMAKE_CURRENT_BINARY_DIR}/Version.cs)

file(GLOB_RECURSE EFTL_cs_files_cmake *.cs ${CMAKE_CURRENT_BINARY_DIR}/*.cs)


# Do the C# build
foreach(EFTL_cs_file ${EFTL_cs_files_cmake})
    file(TO_NATIVE_PATH ${EFTL_cs_file} EFTL_cs_file_native)
    set(EFTL_cs_files_native ${EFTL_cs_files_native} ${EFTL_cs_file_native})
endforeach()


set(WINRT_REF /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/Microsoft.CSharp.dll /r:c:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/Microsoft.Devices.Sensors.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/Microsoft.Phone.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/Microsoft.Phone.Interop.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/Microsoft.Phone.Maps.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/Microsoft.Phone.Reactive.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/Microsoft.Xna.Framework.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/mscorlib.dll   /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/Microsoft.Xna.Framework.GamerServices.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/Microsoft.Xna.Framework.GamerServicesExtensions.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/Microsoft.Xna.Framework.Input.Touch.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/Microsoft.Xna.Framework.MediaLibraryExtensions.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/mscorlib.extensions.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Collections.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.ComponentModel.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.ComponentModel.EventBasedAsync.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Core.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Data.Linq.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Device.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Diagnostics.Contracts.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Diagnostics.Debug.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Diagnostics.Tools.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Dynamic.Runtime.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Globalization.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.IO.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Linq.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Linq.Expressions.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Linq.Queryable.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Net.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Net.NetworkInformation.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Net.Primitives.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Net.Requests.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.ObjectModel.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Observable.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Reflection.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Reflection.Emit.IlGeneration.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Reflection.Emit.Lightweight.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Reflection.Extensions.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Reflection.Primitives.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Resources.ResourceManager.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Runtime.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Runtime.Extensions.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Runtime.InteropServices.WindowsRuntime.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Runtime.Serialization.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Runtime.Serialization.Json.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Runtime.Serialization.Primitives.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Runtime.Serialization.Xml.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Runtime.WindowsRuntime.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Security.Principal.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.ServiceModel.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.ServiceModel.Http.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.ServiceModel.Primitives.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.ServiceModel.Security.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.ServiceModel.Web.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Text.Encoding.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Text.Encoding.Extensions.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Text.RegularExpressions.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Threading.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Threading.Tasks.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Windows.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Xml.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Xml.Linq.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Xml.ReaderWriter.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Xml.Serialization.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Xml.XDocument.dll /r:C:/"Program Files \(x86\)"/"Reference Assemblies"/Microsoft/Framework/WindowsPhone/v8.0/System.Xml.XmlSerializer.dll /r:C:/"Program Files \(x86\)"/"Windows Phone Kits"/8.0/"Windows Metadata"/Windows.winmd)

set(WINRT_REF "${WINRT_REF}" PARENT_SCOPE) 

add_custom_command(OUTPUT ${EFTL_CLIENT_LIB}
    COMMAND C:/Windows/Microsoft.NET/Framework/v4.0.30319/Csc /noconfig /nowarn:1701,1702,2008 /nostdlib+ /errorreport:prompt /warn:4 /define:DEBUG\;TRACE\;SILVERLIGHT\;WINDOWS_PHONE /errorendlocation /target:library /preferreduilang:en-US ${WINRT_REF} /out:${EFTL_CLIENT_LIB} ${EFTL_CLASSLIB_FLAGS} /utf8output /keyfile:${EFTL_KEY_FILE} ${EFTL_cs_files_native} DEPENDS ${EFTLclr_cs_files} ${EFTL_cs_files_cmake}
    ) 

install(FILES ${CMAKE_CURRENT_BINARY_DIR}/TIBCO.EFTL.WINRT.DLL DESTINATION sdks/dotnet/bin/winrt COMPONENT winrt)


add_custom_target(CETUS_EFTL_WINRT_classlib ALL DEPENDS
    ${CMAKE_CURRENT_BINARY_DIR}/AssemblyInfo.cs
    ${CMAKE_CURRENT_BINARY_DIR}/Version.cs
    TIBCO.EFTL.WINRT.dll)

add_library(TIBCO.EFTL.WINRT SHARED IMPORTED)

install(FILES ${EFTL_CLIENT_LIB} DESTINATION bin/winrt COMPONENT winrt)
